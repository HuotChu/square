var square=function(){"use strict";String.prototype.trim=function(){return this.replace(/^\s|\s$/g,"")},function(){var isChromium=window.chrome,vendorName=window.navigator.vendor,isOpera=window.navigator.userAgent.indexOf("OPR")>-1,isIEedge=window.navigator.userAgent.indexOf("Edge")>-1;null!==isChromium&&void 0!==isChromium&&"Google Inc."===vendorName&&0==isOpera&&0==isIEedge||(Array.prototype.indexOf=function(val){var i=0,len=this.length;for(i;len>i;++i)if(this[i]===val)return i;return-1})}(),Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(target){var i,len,keysArray,nextSource,nextIndex,nextKey,desc,to;if(void 0===target||null===target)throw new TypeError("Cannot convert first argument to object");for(to=Object(target),i=1,len=arguments.length;len>i;++i)if(nextSource=arguments[i],void 0!==nextSource&&null!==nextSource)for(nextSource=Object(nextSource),keysArray=Object.keys(nextSource),nextIndex=0,len=keysArray.length;len>nextIndex;++nextIndex)nextKey=keysArray[nextIndex],desc=Object.getOwnPropertyDescriptor(nextSource,nextKey),void 0!==desc&&desc.enumerable&&(to[nextKey]=nextSource[nextKey]);return to}});var request=function(uri,post){return uri=decodeURI(uri),new Promise(function(resolve,reject){var xhr=new XMLHttpRequest,separatorIndex=uri.indexOf("?"),sliceIndex=0>separatorIndex?uri.length:separatorIndex,resource=uri.slice(0,sliceIndex),args=uri.slice(sliceIndex+1).split("&");xhr.open(post?"POST":"GET",resource),post&&xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded"),xhr.onload=function(){var len,prop,val,temp,i=0;if(xhr.response){if(args.length)for(xhr.uriArgs={},len=args.length,i;len>i;++i)temp=args[i].split("="),prop=temp[0],val=temp[1],xhr.uriArgs[prop]=val;resolve(xhr)}else reject(Error(xhr.statusText))},xhr.onerror=function(){reject(Error("Network Error"))},xhr.send(post?args:null)})},temple=function(){var _re1=/\{\{([\w\-\.]*)\}\}/gim,_re2=/\{\{\+([\w\-\.]+)\}\}/gim,templateSignature=/<\s*(\w+)[^>]+data-template="([^"]+)"(?:[^\/]*>.*[\r\n\w\W]*?<\s*\/\s*\1\s*>|\s*\/\s*>)/gim,_cache={},_html2Dom=function(html){var container=document.createElement("div");return container.innerHTML=html,container.firstChild},createRepeatingElements=function(data,elm){var row,str="",i=0,max=elm.getAttribute("data-repeat-count"),prop=elm.getAttribute("data-repeat"),len=(data=data[prop])?data.length||max:0,replaceVars=function(match,p1){return this[p1]};for(i;len>i;++i)row=data[i],str+=elm.outerHTML.replace(_re2,replaceVars.bind(row));return str=str.replace(/\sdata-repeat="\w+"/gi,""),max&&(str=str.replace(/\sdata-repeat-count="\d+"/gi,"")),elm.parentNode.innerHTML?elm.parentNode.innerHTML=str:(elm.parentNode.childNodes[0].innerHTML=str,elm=elm.parentNode.childNodes[0]),elm},getArgs=function(node){for(var attr,attrs=node.attributes,i=0,len=attrs.length,args=[];len>i;++i)attr=attrs[i],0===attr.nodeName.indexOf("data-event-args-")&&args.push(attr.value);return args},build=function(box){return getTemplate(box.template,!0).then(function(templateStr){templateStr.replace(templateSignature,function(match,p1,p2){match=match.replace(/\{\{\+/g,"{{"),match=match.replace(/\sdata-repeat="\w+"/gi,""),box.templates[p2]=match.replace(/\sdata-template="[\w\-_]+"/gi,"")});var i,len,j,jLen,repeaters,repeater,domNodes,nodes,node,handlers,handler,newHandler,html=templateStr.replace(_re1,function(match,p1){for(var nodes=p1.split("."),node=nodes.shift(),len=nodes.length,data=box.data,returnVal=data?data[node]:"";len>0;)node=nodes.shift(),len=nodes.length,returnVal=returnVal[node];return returnVal instanceof Function&&(returnVal=returnVal.call(data)),"undefined"!==returnVal?returnVal:""}),hub=box.model,handlerArray=[];for(html=_html2Dom(html),box.appendChild(html),html=box.firstChild,repeaters=html.querySelectorAll("[data-repeat]"),0===repeaters.length&&(repeaters=html.getAttribute("data-repeat")?[html]:[]),i=0,len=repeaters.length;len>i;++i)repeater=repeaters[i],createRepeatingElements(box.data,repeater);for(domNodes=html.querySelectorAll("[data-index]"),i=0,len=domNodes.length;len>i;++i)node=domNodes[i],box.index[node.getAttribute("data-index")]=node;for(handlers=box.domEvents,i=0,len=handlers.length;len>i;++i)if(handler=handlers[i],handler.id)for(handler.id=handler.id.replace(/^_/,""),nodes=html.querySelectorAll("[data-index="+handler.id+"]"),nodes.length||(nodes=html.querySelectorAll("[data-index^=_"+handler.id+"]")),j=0,jLen=nodes.length;jLen>j;++j)node=nodes[j],node&&(newHandler={},newHandler.args=getArgs(node),newHandler.event=handler.event,newHandler.context=handler.context,newHandler.callback=handler.callback,handlerArray.push(newHandler),node.addEventListener(newHandler.event,function(){var h=this.handler,args=Array.from(h.args);return args.push(this.node),args.push(this.box),h.callback.apply(h.context||null,args)}.bind({handler:newHandler,node:node,box:box})));else handlerArray.push(handler);if(box.domEvents=Array.from(handlerArray),handlerArray=[],hub.addListener){for(handlers=box.modelEvents,i=0,len=handlers.length;len>i;++i)if(handler=handlers[i],handler.id)for(handler.id=handler.id.replace(/^_/,""),nodes=html.querySelectorAll("[data-index="+handler.id+"]"),nodes.length||(nodes=html.querySelectorAll("[data-index^=_"+handler.id+"]")),j=0,jLen=nodes.length;jLen>j;++j)node=nodes[j],node&&(newHandler={},newHandler.args=getArgs(node),newHandler.event=handler.event,newHandler.context=handler.context,newHandler.callback=handler.callback,handlerArray.push(newHandler),hub.addListener(newHandler.event,function(detail){var h=this.handler,args=Array.from(h.args);return args.push(detail),args.push(this.node),args.push(this.box),h.callback.apply(h.context||null,args)}.bind({handler:newHandler,node:node,box:box}),node));else handlerArray.push(handler);box.modelEvents=Array.from(handlerArray)}return html.box=box,box.destination&&box.destination.appendChild(box),box})},cache=function(name,template){_cache[name]=template},getCached=function(name){return _cache[name]},getTemplate=function(uri,useCache){return uri=decodeURI(uri),new Promise(function(resolve,reject){var cachedTemplate,xhr=new XMLHttpRequest,separatorIndex=uri.indexOf("?"),sliceIndex=0>separatorIndex?uri.length:separatorIndex,resource=uri.slice(0,sliceIndex),cachedName=resource.replace(/\/|\./g,"");return-1!==uri.indexOf("<")?void resolve(uri):useCache&&(cachedTemplate=getCached(cachedName))?void resolve(cachedTemplate):(xhr.open("GET",resource),xhr.onload=function(){var response=xhr.response;response?(useCache&&cache(cachedName,response),resolve(response)):reject(Error(xhr.statusText))},xhr.onerror=function(){reject(Error("Network Error"))},void xhr.send())})};return{build:build}}(),box=function(){var buildABox=function(items,fragment){var frag=fragment||document.createDocumentFragment(),data=items.data||frag.data||[],model=items.model||frag.model||[],target=items.target||frag.target||"",template=items.template||frag.template||"",templates=items.templates||frag.templates,domEvents=items.domEvents||frag.domEvents,modelEvents=items.modelEvents||frag.modelEvents;return frag.data=data,frag.model=model,frag.destination=target,frag.index=frag.index||{},frag.template=template,frag.templates=templates||{},frag.domEvents=domEvents||[],frag.modelEvents=modelEvents||[],frag.vanish=function(){},frag.shed=function(){},frag.build=function(config,frag){var box=buildABox(config,frag);return temple.build(box)},frag.parse=function(box){return temple.build(box||this).outerHTML},frag};return function(config){var box=buildABox(config);this.__proto__={view:temple.build(box)},this.prototype||Object.defineProperty(this,"prototype",{enumerable:!1,configurable:!1,value:this.__proto__})}}(),eventHub=function(){var createEventNode=function(){return document.createElement("object")},customEvent=function(eventName,detail,cancel,exposeAll){return new CustomEvent(eventName,{cancelable:!!cancel,detail:exposeAll?exposeDetail(detail):detail})},exposeDetail=function(o){var val,prop,no={__exposedProps__:{}};for(prop in o)o.hasOwnProperty(prop)&&(val=o[prop],no[prop]=val,no.__exposedProps__[prop]=val);return no},watchers={},callBacks={},dispatch=function(eventName,detail,bubbles,cancel,exposeAll){var hub=this.eventNode,crud="",path=eventName.replace(/(\.\w{4,6})$/i,function(match,capture){return crud=capture,""}),fireEvents=function(){hub.dispatchEvent(customEvent(path+crud,detail,cancel,exposeAll)),".read"!==crud?hub.dispatchEvent(customEvent(path+".change",detail,cancel,exposeAll)):hub.dispatchEvent(customEvent(path+".all",detail,cancel,exposeAll))};if(detail=detail||{},detail.origin=eventName,fireEvents(),bubbles!==!1)for(;;){if(path=path.split("."),detail.lastNode=path.pop(),!path.length)break;path=path.join("."),fireEvents()}return!0},addListener=function(eventName,callBack,currentTarget){var listener,watchers=this.watchers,eventArray=watchers[eventName];return currentTarget&&(callBack=callBack.bind(currentTarget)),eventArray||(eventArray=watchers[eventName]=[]),listener=this.eventNode.addEventListener(eventName,callBack,!1),eventArray.push(listener),listener},removeListener=function(listener){return this.eventNode.removeEventListener(listener)},garbageCollect=function(deadObject){var watcher,len,event=deadObject.event,watchers=this.watchers,watcherArray=watchers[event],i=0;if(event&&watcherArray){for(len=watcherArray.length;len>i;++i)watcher=watcherArray[i],this.removeListener(watcher);watchers[event]=null,delete watchers[event]}},connect=function(o){var newO,proto=o.__proto__;return newO=Object.create(proto),Object.assign(newO.__proto__,hub),newO.__proto__.eventNode=createEventNode(),newO},hub={connect:connect,callBacks:callBacks,watchers:watchers,dispatch:dispatch,addListener:addListener,removeListener:removeListener,garbageCollect:garbageCollect};return hub}(),lobro=function(){var lo=window.localStorage,putLocal=function(table){var json;try{json=JSON.stringify(table),json&&lo.setItem(table._event,json)}catch(err){console.log(err)}},remove=function(name){lo.removeItem(name)},persist=function(db,version){var table,o={version:version||1};Object.defineProperty(o,"_event",{enumerable:!1,value:db._event});for(table in db)db.hasOwnProperty(table)&&putLocal(db[table]);putLocal(o)},sync=function(dbName){var key,store={},reg=new RegExp("^"+dbName+"\\.[\\w\\-_\\.]+");store[dbName]={},store=store[dbName];for(key in lo)lo.hasOwnProperty(key)&&reg.test(key)&&(store[key]=JSON.parse(lo[key]));return this.restore?this.restore(store,dbName):store},connect=function(o){var newO,proto=o.__proto__,addListener=function(){newO.addListener(newO._event+".change",function(event){var origin=event.detail.origin,reg=new RegExp("^"+newO._event+"\\.([^\\.]+)","i"),table=origin.match(reg);table=table&&table[1],table&&"string"==typeof table&&/create|read|update|delete/.test(table)===!1&&newO.putLocal(newO[table])},newO)},enableEvents="",loadingPromise=new Promise(function(resolve){enableEvents=resolve});return newO=Object.create(proto),Object.assign(newO.__proto__,lobro),newO.__proto__.enableEvents=enableEvents,newO.dispatch&&loadingPromise.then(function(){addListener()}),newO},getLocal=function(name){var table=lo.getItem(name);return table&&(table=JSON.parse(table)),table},clear=function(){return lo.clear(),lo},isCurrent=function(dbName,version){var exists=getLocal(dbName);return exists&&exists.version===version},lobro={connect:connect,isCurrent:isCurrent,clearLocal:clear,getLocal:getLocal,putLocal:putLocal,persist:persist,removeLocal:remove,sync:sync};return lobro}(),squaredb=function(){var Table=function(db,tableName){return this.__proto__={_db:db,_event:db._event+"."+tableName,constructor:this,columns:function(){var prop,cols=[];for(prop in this)this.hasOwnProperty(prop)&&cols.push(prop);return cols},count:function(){var len=this.indices().length,db=this._db;return db.dispatch&&db.dispatch(this._event+".count.read",{value:len}),len},indices:function(){var col,prop,len,indices=[],i=0;for(prop in this)if(this.hasOwnProperty(prop)){for(col=this[prop],len=col.length;len>i;++i)null!==col[i]&&indices.push(i);return indices}return indices},holes:function(){var col,prop,len,holes=[],i=0;for(prop in this)if(this.hasOwnProperty(prop)){for(col=this[prop],len=col.length;len>i;++i)null===col[i]&&holes.push(i);return holes}return holes}},this.prototype||Object.defineProperty(this,"prototype",{enumerable:!1,configurable:!1,value:this.__proto__}),this},Column=function(table,columnName){return this.__proto__={_event:table&&columnName&&table._event+"."+columnName,_db:table&&table._db,_table:table,push:function(x){var db=this._db,pushed=Array.prototype.push.call(this,x);return db.dispatch&&(db.dispatch(this._event+".create",{value:x,index:this.length-1}),this._table.count()),pushed},insert:function(x,ndx){var db=this._db;this[ndx]=x,db.dispatch&&db.dispatch(this._event+"."+ndx+".update",{value:x,index:ndx})}},this.prototype||(Object.defineProperty(this,"prototype",{enumerable:!1,configurable:!1,value:this.__proto__}),this.prototype.__proto__=Array.prototype),this},_memory={},getColumnNames=function(){var columnNames=Array.from(arguments);return 1===columnNames.length&&(columnNames=columnNames[0],-1!==columnNames.indexOf(",")&&(columnNames=columnNames.split(",").map(function(el){return el.trim()})),columnNames instanceof Array==!1&&(columnNames=[columnNames])),columnNames},Where=function(table,column,operator,control){this.validIndices=comparator(table[column],operator,control),this.AND=this.and=function(column,operator,control){var newIndices=comparator(table[column],operator,control);return this.validIndices=this.validIndices.filter(function(v){return-1!==newIndices.indexOf(v)}),this},this.OR=this.or=function(column,operator,control){var cache=[];return this.validIndices=this.validIndices.concat(comparator(table[column],operator,control)),this.validIndices=this.validIndices.filter(function(v){return-1===cache.indexOf(v)?(cache.push(v),!0):void 0}),this}};_memory.__proto__={create:function(dbName){var db=new DB(dbName);return this[dbName]=db,db},drop:function(dbName){return this[dbName]?(this[dbName]=null,delete this[dbName],!0):!1},get:function(dbName){return this[dbName]},show:function(){var prop,arr=[];for(prop in this)this.hasOwnProperty(prop)&&arr.push(prop);return arr}};var DB=function(dbName){return this.__proto__={_event:dbName,_tableCount:0,count:function(){var count=this._tableCount;return this.dispatch&&this.dispatch(this._event+".count.read",{value:count}),count},COUNT:function(){return this.count.call(this)},select:function(){var selects=getColumnNames.apply(null,arguments);return new Select(this,selects)},SELECT:function(){return this.select.apply(this,arguments)},createTable:function(tableName){var db=this,table=new Table(db,tableName);return db[tableName]=table,db.dispatch&&db.dispatch(this._event+".create",{value:table}),++this._tableCount,this.count(),function(){var columns=getColumnNames.apply({},arguments);return columns.length&&db.alterTable(tableName).add.apply({},arguments),table}},CREATE_TABLE:function(tableName){return this.createTable.call(this,tableName)},alterTable:function(tableName){var table=this[tableName];return{add:function(){var col,newColumn,cols=getColumnNames.apply(null,arguments),i=0,len=cols.length,indices=table.indices(),holes=table.holes(),j=0,jLen=indices.length,db=table._db;for(i;len>i;++i){for(col=cols[i],newColumn=table[col]=new Column(table,col),j=0;jLen>j;++j)newColumn.insert(void 0,indices[j]);for(jLen=holes.length,j=0;jLen>j;++j)newColumn.insert(null,holes[j]);db.dispatch&&db.dispatch(table._event+".create",{value:newColumn})}return table},ADD:function(){return this.add.apply(this,arguments)},drop:function(){var col,len,cols=getColumnNames.apply(null,arguments),i=0,db=table._db;for((0===cols.length||"*"===cols[0])&&(cols=table.columns()),len=cols.length;len>i;++i)col=cols[i],table[col]=null,delete table[col],db.dispatch&&db.dispatch(table._event+".delete",{value:col});return table},DROP:function(){return this.drop.apply(this,arguments)},modify:function(){}}},ALTER_TABLE:function(tableName){return this.alterTable.call(this,tableName)},insertInto:function(tableName){var table=this[tableName];return function(){var columns=getColumnNames.apply({},arguments),values=function(){var column,columnName,val,vals=Array.from(arguments),i=0,len=columns.length;for(i;len>i;++i)columnName=columns[i],val=vals[i],column=table[columnName],column.push(val);for(columnName in table)table.hasOwnProperty(columnName)&&-1===columns.indexOf(columnName)&&table[columnName].push(void 0);return values};return{values:values,VALUES:values}}},INSERT_INTO:function(tableName){return this.insertInto.call(this,tableName)},insertJsonInto:function(tableName){var table=this[tableName],db=this;return function(insertObjects){var prop,insert,columnNames,add,vals,i=0,len=insertObjects.length,tableName=table._event.substr(table._event.indexOf(".")+1),insertToColumns=db.insertInto(tableName);for(i;len>i;++i){insert=insertObjects[i],columnNames=[],vals=[];for(prop in insert)insert.hasOwnProperty(prop)&&(table[prop]||db.alterTable(tableName).add(prop),columnNames.push(prop),vals.push(insert[prop]));add=insertToColumns.apply(null,columnNames),add.values.apply(null,vals)}}},INSERT_JSON_INTO:function(tableName){this.insertJsonInto.call(this,tableName)},update:function(tableName){var table=this[tableName],db=table._db,updateMap={},set=function(column,value){return updateMap[column]=value,set};return set.WHERE=set.where=function(column,operator,control){var w=new Where(table,column,operator,control);return w.GO=w.go=function(){var ndx,prop,val,i=0,len=this.validIndices.length,crud=".update";for(i;len>i;++i){ndx=this.validIndices[i];for(prop in table)table.hasOwnProperty(prop)&&updateMap[prop]&&(val=updateMap[prop],table[prop][ndx]=val,db.dispatch&&(null===val&&(crud=".delete"),db.dispatch(table._event+"."+prop+crud,{value:val,index:ndx})))}return!0},w},{set:set,SET:set}},UPDATE:function(tableName){return this.update.call(this,tableName)},"delete":function(){var table,columns=getColumnNames.apply({},arguments),db=this,from=function(tableName){return table=db[tableName],(0===columns.length||"*"===columns[0])&&(columns=table.columns()),{where:where,WHERE:where,go:go,GO:go}},go=function(){var len,ndx,j,column,matches=this.validIndices,i=0,colLen=columns.length;for(void 0===matches&&(matches=table.indices()),len=matches.length;len>i;++i)for(ndx=matches[i],j=0;colLen>j;++j)column=table[columns[j]],column.insert(null,ndx),db.dispatch&&(db.dispatch(column._event+"."+ndx+".delete",{value:null,index:ndx}),--table._tableCount,table.count());return!0},where=function(column,operator,control){var w=new Where(table,column,operator,control);return w.GO=w.go=go.bind(w),w};return{from:from,FROM:from}},DELETE:function(){return this["delete"].apply(this,arguments)},createUnique:function(){for(var n,a,tsa=(new Date).getTime().toString().split(""),abc=["a","b","c","d","e","f","g","h","i","j"],i=0,len=tsa.length,rtn=[];len>i;++i)n=tsa[i],a=abc[n],i%2===0?(i%8===4&&(a=a.toUpperCase()),rtn.push(a)):rtn.push(n);return rtn=rtn.map(function(v){switch(v){case"0":return"O";case"1":return"I";case"2":return"R";case"3":return"E";case"4":return"F";case"5":return"S";case"6":return"b";case"7":return"L";case"8":return"B";case"9":return"q";default:return v}}),rtn.join("")},restore:function(backup,dbName){var i,len,path,insert,table,columns,tempArray,tableName="",reg=new RegExp(dbName+"\\.(.+)");for(path in backup)if(backup.hasOwnProperty(path))for(tableName=path.match(reg)[1],table=backup[path],columns=Object.keys(backup[path]),this.createTable(tableName)(columns),len=table[columns[0]].length,insert=this.insertInto(tableName)(columns),i=0;len>i;++i)tempArray=[],columns.forEach(function(column){tempArray.push(table[column][i])}),insert.values.apply(this,tempArray)}},this.prototype||Object.defineProperty(this,"prototype",{enumerable:!1,configurable:!1,value:this.__proto__}),this};return{createDB:_memory.create,CREATE_DATABASE:_memory.create,dropDB:_memory.drop,DROP_DATABASE:_memory.drop,use:_memory.get,USE:_memory.get,show:_memory.show,SHOW_DATABASES:_memory.show}}(),aggregates=function(){return function(sortObject,operation,targetColumn){var column,val,valid,sortArray=sortObject[targetColumn],columnNames=[],len=sortArray.length;for(column in sortObject)sortObject.hasOwnProperty(column)&&columnNames.push(column);if(val=sortArray.reduce(function(previous,current){var rtn;return"min"===operation?rtn=current>previous?previous:current:"max"===operation?rtn=previous>current?previous:current:("sum"===operation||"avg"===operation)&&(rtn=previous+current),rtn}),"avg"===operation)val/=len;else if("count"===operation)return val=len*columnNames.length,sortObject={QUERY_COUNT:[val]};return columnNames.length>1&&(valid=comparator(sortObject[targetColumn],"===",val),columnNames.forEach(function(cName){cName!==targetColumn&&(column=sortObject[cName],sortObject[cName]=column.filter(function(v,i){return-1!==valid.indexOf(i)}))})),sortObject[targetColumn]=[val],sortObject}}(),comparator=function(){return function(column,operator,control){var found,row,inMatches,regX,firstPeriod="string"==typeof control?control.indexOf("."):-1,secondPeriod="string"==typeof control?control.lastIndexOf("."):-1,startsWith=0!==firstPeriod,endsWith=control.length&&secondPeriod!==control.length-1,i=0,len=column.length,matches=[];for(("like"===operator||"not like"===operator)&&(startsWith&&(control="^"+control),endsWith&&(control+="$")),i;len>i;++i)if(row=column[i]){switch(operator){case"==":found=row==control;break;case"===":found=row===control;break;case">":found=row>control;break;case"<":found=control>row;break;case">=":found=row>=control;break;case"<=":found=control>=row;break;case"!=":found=row!=control;break;case"!==":found=row!==control;break;case"like":regX=new RegExp(control,"i"),found=regX.test(row);break;case"not like":regX=new RegExp(control,"i"),found=!regX.test(row);break;default:found=!1}inMatches=matches.indexOf(i)>-1,found&&!inMatches&&matches.push(i)}return matches}}(),go=function(){var go=function(queryObject){var aggregate,regExpMatches,validIndices,newIndices,response,select,columnName,column,initial,i,j,jLen,and,andi,or,ori,ndx,prop,o=queryObject,db=o.db,table=o.table,distinct=o.distinct,selects=o.selects,where=o.where,len=selects.length||1,returnArrays={},aggregateStore={},getAllColumns=function(){selects=Object.keys(table),len=selects.length,columnName=selects[0]};for(i=0;len>i;++i)columnName=selects[i],columnName=columnName.replace(/['"]/g,""),-1!==columnName.indexOf("(")&&(regExpMatches=columnName.match(/^(\w+)\(([^\)]+)\)/),columnName=regExpMatches[2],"*"===columnName&&getAllColumns(),aggregateStore[columnName]=regExpMatches[1]),-1!==columnName.indexOf(" as ")&&(columnName=columnName.replace(/(^\w+)\sas\s\w+/,"$1")),"*"===columnName&&getAllColumns(),column=table[columnName]||[],returnArrays[columnName]=column.filter(function(v){return null!==v}),validIndices=table.indices();if(where){if(initial=where.initial,or=where.or,and=where.and,validIndices=comparator(table[initial[0]],initial[1],initial[2]),or.length)for(i=0,len=or.length;len>i;++i)for(ori=or[i],newIndices=comparator(table[ori[0]],ori[1],ori[2]),j=0,jLen=newIndices.length;jLen>j;++j)ndx=newIndices[j],-1===validIndices.indexOf(ndx)&&validIndices.push(ndx);if(and.length)for(i=0,len=and.length;len>i;++i)andi=and[i],newIndices=comparator(table[andi[0]],andi[1],andi[2]),validIndices=validIndices.filter(function(v){return-1!==this.indexOf(v)}.bind(newIndices));returnArrays=makeValid(returnArrays,validIndices)}distinct?(validIndices=getDistinctIndices(returnArrays[distinct]),response=makeValid(returnArrays,validIndices)):response=returnArrays;for(columnName in aggregateStore)aggregateStore.hasOwnProperty(columnName)&&(aggregate=aggregateStore[columnName],response=aggregates(response,aggregate,columnName));if(response=toJsonArray(response),aggregate&&(response=response[0]),db.dispatch)for(i=0,len=response.length;len>i;++i){select=response[i],ndx=validIndices[i];for(prop in select)select.hasOwnProperty(prop)&&db.dispatch(table._event+"."+prop+"."+ndx+".read",{value:select[prop]})}return response},makeValid=function(returnArrays,validIndices){var columnName;for(columnName in returnArrays)returnArrays.hasOwnProperty(columnName)&&(returnArrays[columnName]=returnArrays[columnName].filter(function(v,i){return-1!==validIndices.indexOf(i)}));return returnArrays},getDistinctIndices=function(a){var cache=[],keep=[];return a.filter(function(v,i){return-1===cache.indexOf(v)&&null!==v?(cache.push(v),keep.push(i),!0):void 0}),keep},toJsonArray=function(returnArrays){var columnName,column,len,i,arr=[];for(columnName in returnArrays)if(returnArrays.hasOwnProperty(columnName))for(column=returnArrays[columnName],len=column.length,i=0;len>i;++i)arr[i]||(arr[i]={}),arr[i][columnName]=column[i];return arr};return go}(),Select=function(){var QueryObject=function(selects){this.selects=selects};QueryObject.prototype={db:void 0,distinct:!1,selects:[],table:void 0,where:void 0};var Where=function(queryObject,column,comparator,control){this._queryObject=queryObject,queryObject.where={initial:[column,comparator,control],and:[],or:[]}};Where.prototype={and:function(column,comparator,control){return this._queryObject.where.and.push([column,comparator,control]),this},or:function(column,comparator,control){return this._queryObject.where.or.push([column,comparator,control]),this},go:function(){return go(this._queryObject)},GO:function(){return go(this._queryObject)}};var where=function(column,comparator,control){return new Where(this._queryObject,column,comparator,control)},From=function(queryObject,tableName){this._queryObject=queryObject,this._table=queryObject.db[tableName],queryObject.table=this._table},from=function(tableName){return new From(this._queryObject,tableName)};From.prototype={_table:void 0,where:function(){return where.apply(this,arguments)},WHERE:function(){return where.apply(this,arguments)},go:function(){return go(this._queryObject)},GO:function(){return go(this._queryObject)}};var distinct=function(columnName){var db=this._queryObject.db;return this._queryObject=new QueryObject([columnName]),this._queryObject.distinct=columnName,this._queryObject.db=db,this},Select=function(db,selects){return this._queryObject=new QueryObject(selects||"*"),this._queryObject.db=db,this};return Select.prototype={_queryObject:{},from:function(){return from.apply(this,arguments)},FROM:function(){return from.apply(this,arguments)},distinct:function(){return distinct.apply(this,arguments)},DISTINCT:function(){return distinct.apply(this,arguments)}},Select}();return{Box:box,eventHub:eventHub,lobro:lobro,request:request,temple:temple,db:squaredb}}();