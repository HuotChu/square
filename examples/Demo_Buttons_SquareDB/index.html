<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>SquareJS Button Demo</title>

    <link rel="stylesheet" href="style.css" />
</head>
<body>
<a id="forkme_banner" href="https://github.com/blujagu/square">View on GitHub</a>
<div id="button-demo"></div>
<div id="tutorial">
    <h1>Square[JS] "Buttons" Demo & Tutorial</h1>
    <p id="author">by Scott Bishop</p>
    <hr />
    <h2>Overview</h2>
    <hr />
    <p class="content">
        There should be five buttons in the upper-left portion of your screen with the labels <b>Galaxy</b>, <b>Nexus</b>, <b>Lenovo</b>, <b>Apple</b>, and <b>Sony</b>.
        There could easily be more or less of these buttons on the screen, because the Square templating engine, temple.js, is creating one button for each `product object` in the database.
        There's more than templating going on here, though. Box (box.js) has dynamically assigned event handlers to each of those buttons. Here's where it
        gets <i>really</i> cool; two things... First, Box keeps track of all those button DOM nodes and it does so during DOM creation of the nodes, so it's fast.
        The framework never has to search through the entire DOM to find and cache the nodes and you will never trigger a DOM search since the nodes are all properties
        of the Box object. Neat, but the other thing that happens here is even better. When a user clicks the button, a query is automatically triggered against the model
        to look up the data being requested by the button push. In this case, when I push a button, I want to know what the description text is that matches that button.
        Ok, so I push a button and the model responds with data, big deal, right? Actually, it is a big deal. The model may respond with the data, but the
        button doesn't care about that. Why should it, it's just a button! Hidden away until needed, there's a `description` div element on the page. If you click a button
        the div will appear with the correct description on it. Box hooked that div element up to the eventHub, so when a read operations is applied to the model it throws a JavaScript
        event. The div is listening for that event and updates itself! That's great, because the description div <i>is</i> what cares about the data. This mechanism is how one and two way data
        binding are achieved in Square without the need for loops or pub/sub.
    </p>
    <p class="content">
        Now that you understand what the demo is doing "under the hood", let's look at how to build it.
        <br /><br />
        For this demo the requirements are pretty simple:
        <br />
        <i>Fetch json data to get a list of devices.</i>
        <br />
        <i>Create a button for each device name.</i>
        <br />
        <i>When a button is clicked, the matching device description should appear below the buttons.</i>
     </p>
    <hr />
    <p class="content">
        At the root of the project, there are seven files: index.html, overlay.png, style.css, product.html, productBox.js, and productModel.js. I won't go into detail about overlay.png or style.css
        as these files are simply used to make things look pretty. Also, note the SquareJS directory is not shown. This is discussed in the following index.html breakdown.
    </p>
    <div>
        <img src="../demo_1_directories.png" alt="button demo directory structure" />
    </div>
    <hr />
    <h2>Configuration</h2>
    <hr />
    <p class="content">
        Index.html is where the framework and application are configured prior to initializing the app. Moving from top to bottom within the BODY of this file,
        there are three items on the page which are used to prepare the app before it runs.
    </p>
    <div class="codeBlock">
        <h3>Index.html</h3>
        <p>
            This element will be used to attach the view to the DOM when the view is ready.
        </p>
        <p class="code">
            &lt;div id="button-demo"&gt;&lt;/div&gt;
        </p>

        <p>
            Include require.js which is used to load all the modules. The relative path shows require is located outside the main application directory. This is purely a matter of preference.
            You may place require and square in locations that best suite your project.
        </p>
        <p class="code">
            &lt;script src="../../lib/require.js"&gt;&lt;/script&gt;
        </p>

        <p>
            A require.js configuration block must be included before the app runs.
            <br /><br />
            <b>baseUrl</b> <i>string</i> sets the base directory of the application relative to this file.
            <br /><br />
            <b>paths</b> <i>object</i> maps all the SquareJS modules to module names, so the app will know where to find them.
            <br /><br />
            <b>deps</b> <i>array</i> loads any application dependencies. I added productBox.js, causing it to load. When the
            productBox module loads it creates and attaches the view. Before productBox can even be a "thing" though, we should back up
            and create the html template for buttons and description.
        </p>
        <p class="code">
                &lt;script&gt;<br />
                &nbsp;&nbsp;&nbsp;require.config({<br />
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;baseUrl: './',<br />
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;paths: {<br />
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"box": "../../lib/box",<br />
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"db": "../../lib/squaredb/squaredb",<br />
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"eventHub": "../../lib/eventHub",<br />
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"notify": "../../lib/notify",<br />
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"request": "../../lib/request",<br />
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"square": "../../lib/square",<br />
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"aggregates": "../../lib/squaredb/aggregates",<br />
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"comparator":  "../../lib/squaredb/comparator",<br />
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Select":  "../../lib/squaredb/Select",<br />
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"go": "../../lib/squaredb/go",<br />
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"temple": "../../lib/temple"<br />
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br />
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;deps: ['productBox']<br />
                &lt;/script&gt;
        </p>
    </div>

    <hr />
    <h2>Templating with Temple</h2>
    <hr />
    <p class="content">
        The templating structure is pretty simple. Start with a single element and put your required html inside it. Variables which should be replaced by data values are
        denoted with {{variableName}}. If the variable is inside a repeating element, the syntax includes a plus symbol {{+variableName}}.
    </p>
    <div class="codeBlock">
        <h3>product.html</h3>
        <p class="content">
            `data-` property tags are used to give temple special instructions.
            <br /><br />
            <b>data-repeat</b> tells temple to repeat this element and any child elements. The value for data-repeat is "devices" which will match a `devices` array in the data structure.
            <br /><br />
            <b>data-index</b> tells temple to store this element as a property for later lookup. This is required for any element that will have event handlers or data-binding attached.
            <br />
            The value of data-index is used as the property name to look up for retrieval, therefor every data-index in a box must be unique. To accomplish this, I create a data-index
            that begins with the prefix `productButton_` followed by the `id` of the device associated with this button. That productButton_ prefix will come in handy later
            when we want to attach event handlers to all these buttons.
            <br /><br />
            <b>data-event-args-<i>n</i></b> where <i>n</i> begins at zero and is incremented for each additional data-event-args tag. The value of each data-event-args tag is passed
            as an argument to any callback function used as an event handler targeting the element.
            <br /><br />
            In this case, the `id` of each button will be passed in as the first argument to any event handler we later attach to the button. This will serve as a lookup key to
            get the correct description from the model.
        </p>
        <p class="code">
            &lt;span&gt;<br />
            &nbsp;&nbsp;&nbsp;&lt;ul&gt;<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;li data-repeat="devices"&gt;<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span class="button" data-index="productButton_{{+id}}" data-event-args-0="{{+id}}"&gt;<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{+product}}<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/li&gt;<br />
            &nbsp;&nbsp;&nbsp;&lt;/ul><br />
            &nbsp;&nbsp;&nbsp;&lt;div id="description" data-index="desc" class="hidden">&lt;/div&gt;<br />
            &lt;/span&gt;
        </p>
    </div>

    <hr />
    <h2>Model Squared</h2>
    <hr />
    <p class="content">
        Creating the model for our application is incredibly easy, thanks to SquareDB.
    </p>
    <div class="codeBlock">
        <h3>productModel.js</h3>
        <p class="content">
            productModel.js is already well commented, so a quick walk-through should suffice. We start by requesting the devices.json file. Then, when that request
            returns, the data is inserted into a new SquareDB database. This database is hooked up to the eventHub to enable data-binding and event management,
            and the whole thing is returned in an argument to any callback passed to the Promise's `then` method.
        </p>
    </div>

    <hr />
    <h2>Build-A-Box</h2>
    <hr />
    <p class="content">
        Now that we have both a template and a model, it's time to build a box and watch it construct and render our view. Useful things, those boxes. Who knew?
    </p>
    <div class="codeBlock">
        <h3>productBox.js</h3>
        <p>
            The first line of code inside productBox.js <b>define</b>s the `productBox` module based on the file name, then it imports both the box.js module and the productModel.
        </p>
        <p class="code">
            define(['box', 'productModel'], function(Box, productModel) {
        </p>
        <p>
            The model returns a Promise to prevent rendering the UI before we have the data. The Promise's `then` method is used to capture and pass in the actual model.
        </p>
        <p class="code">
            productModel.then(function (model) {
        </p>
        <p>
            Now that we have the model, we need to build our box and to do that, we need to create a boxConfig object. This is just an ordinary object with some rather important
            properties.
        </p>
        <p class="code">
            var boxConfig = {
        </p>
        <p>
            boxConfig properties:
        </p>
        <p>
            <b>model</b> <i>square model object</i> is set to the passed in model argument.
        </p>
        <p class="code">
            model: model,
        </p>
        <p>
            <b>data</b> <i>object</i> maps data in the model to variable names in the html template.
            <br />
            The product.html template has a data-repeat element with the value `devices`, so I need a devices property set to the array of devices.
            <br />
            More specifically, I will need the `product` and `id` of each device in the model, as seen in the template, so I use SquareDB to query for that data.
        </p>
        <p class="code">
            data: {<br />
             &nbsp;&nbsp;&nbsp;devices: model.select('product, id').from('Devices').go()<br />
            },
        </p>
        <p>
            <b>target</b> <i>DOM node</i> if provided, the box will automatically attach the completed view to this DOM element.
        </p>
        <p class="code">
            target: document.querySelector('#button-demo'),
        </p>
        <p>
            <b>template</b> <i>string</i> url of the template file for this view.
        </p>
        <p class="code">
            template: 'product.html',
        </p>
        <p>
            <b>domEvents</b> <i>array of objects</i> each object represents an event handler that needs to be attached to one or more DOM elements.
        </p>
        <p class="code">
            domEvents: [<br />
            &nbsp;&nbsp;&nbsp;{<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event: 'click',<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id: 'showProduct_',<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;callback: function (id, domNode, box) {<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;box.index['desc'].className = 'hidden';<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;model.select('desc')<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.from('Devices')<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.where('id', '===', id).go();<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
            &nbsp;&nbsp;&nbsp;}<br />
            ],
        </p>
        <p>
            <br /><br />
            <b>modelEvents</b> <i></i>
        </p>
    </div>

    <p>
        <i>To be continued...</i>
    </p>
</div>
    <script src="../../lib/require.js"></script>
    <script>
        require.config({
            baseUrl: './',
            paths: {
                "box": "../../lib/box",
                "db": "../../lib/squaredb/squaredb",
                "eventHub": "../../lib/eventHub",
                "notify": "../../lib/notify",
                "request": "../../lib/request",
                "square": "../../lib/square",
                "aggregates": "../../lib/squaredb/aggregates",
                "comparator":  "../../lib/squaredb/comparator",
                "Select":  "../../lib/squaredb/Select",
                "go": "../../lib/squaredb/go",
                "temple": "../../lib/temple"
            },
            deps: ['productBox']
        });
    </script>
</body>
</html>